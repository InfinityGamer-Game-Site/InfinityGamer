function GameManager(e,t,i,a){this.size=e,this.inputManager=new t,this.scoreManager=new a,this.actuator=new i,this.startTiles=2,this.inputManager.on("move",this.move.bind(this)),this.inputManager.on("restart",this.restart.bind(this)),this.inputManager.on("keepPlaying",this.keepPlaying.bind(this)),this.setup()}GameManager.prototype.restart=function(){this.actuator.continue(),this.setup()},GameManager.prototype.keepPlaying=function(){this.keepPlaying=!0,this.actuator.continue()},GameManager.prototype.isGameTerminated=function(){return!!(this.over||this.won&&!this.keepPlaying)},GameManager.prototype.setup=function(){this.grid=new Grid(this.size),this.score=0,this.over=!1,this.won=!1,this.keepPlaying=!1,this.addStartTiles(),this.actuate()},GameManager.prototype.addStartTiles=function(){for(var e=0;e<this.startTiles;e++)this.addRandomTile()},GameManager.prototype.addRandomTile=function(){var e;this.grid.cellsAvailable()&&(e=Math.random()<.9?2048:1024,e=new Tile(this.grid.randomAvailableCell(),e),this.grid.insertTile(e))},GameManager.prototype.actuate=function(){this.scoreManager.get()<this.score&&this.scoreManager.set(this.score),this.actuator.actuate(this.grid,{score:this.score,over:this.over,won:this.won,bestScore:this.scoreManager.get(),terminated:this.isGameTerminated()})},GameManager.prototype.prepareTiles=function(){this.grid.eachCell(function(e,t,i){i&&(i.mergedFrom=null,i.savePosition())})},GameManager.prototype.moveTile=function(e,t){this.grid.cells[e.x][e.y]=null,(this.grid.cells[t.x][t.y]=e).updatePosition(t)},GameManager.prototype.move=function(e){var r,n,s,t,o,h=this;this.isGameTerminated()||(s=this.getVector(e),t=this.buildTraversals(s),o=!1,this.prepareTiles(),t.x.forEach(function(a){t.y.forEach(function(e){var t,i;r={x:a,y:e},(n=h.grid.cellContent(r))&&(e=h.findFarthestPosition(r,s),(t=h.grid.cellContent(e.next))&&t.value===n.value&&!t.mergedFrom?((i=new Tile(e.next,n.value/2)).mergedFrom=[n,t],h.grid.insertTile(i),h.grid.removeTile(n),n.updatePosition(e.next),h.score+=i.value,1===i.value&&(h.won=!0)):h.moveTile(n,e.farthest),h.positionsEqual(r,n)||(o=!0))})}),o&&(this.addRandomTile(),this.movesAvailable()||(this.over=!0),this.actuate()))},GameManager.prototype.getVector=function(e){return{0:{x:0,y:-1},1:{x:1,y:0},2:{x:0,y:1},3:{x:-1,y:0}}[e]},GameManager.prototype.buildTraversals=function(e){for(var t={x:[],y:[]},i=0;i<this.size;i++)t.x.push(i),t.y.push(i);return 1===e.x&&(t.x=t.x.reverse()),1===e.y&&(t.y=t.y.reverse()),t},GameManager.prototype.findFarthestPosition=function(e,t){for(var i;e={x:(i=e).x+t.x,y:i.y+t.y},this.grid.withinBounds(e)&&this.grid.cellAvailable(e););return{farthest:i,next:e}},GameManager.prototype.movesAvailable=function(){return this.grid.cellsAvailable()||this.tileMatchesAvailable()},GameManager.prototype.tileMatchesAvailable=function(){for(var e,t=0;t<this.size;t++)for(var i=0;i<this.size;i++)if(e=this.grid.cellContent({x:t,y:i}))for(var a=0;a<4;a++){var r={x:t+(r=this.getVector(a)).x,y:i+r.y};if((r=this.grid.cellContent(r))&&r.value===e.value)return!0}return!1},GameManager.prototype.positionsEqual=function(e,t){return e.x===t.x&&e.y===t.y};